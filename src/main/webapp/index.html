<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Versus - Distribution</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href="bootstrap/css/bootstrap.css" rel="stylesheet">
    <style>
      body {
        padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
      }
    </style>
    <link href="bootstrap/css/bootstrap-responsive.css" rel="stylesheet">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="../assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../assets/ico/apple-touch-icon-144-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
    
    <script src="bootstrap/js/jquery-1.7.2.js"></script>
    <script type="text/javascript" src="distributionScripts.js"></script>
    
    
</head>
<body>
<div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="#">Versus Distribution Service</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li class="active"><a href="VersusDistribution.html">Home</a></li>
              <li><a href="VersusDistribution-About.html">About</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>
    
    <div class="container-fluid">
      <div class="row-fluid">
        <div class="span3">
          <div class="well sidebar-nav">
            <ul class="nav nav-list">
              <li class="nav-header">Decision Support Service</li>
              <li><a href="dss.html">Adapters</a></li>
              <li><a href="#">Extractors</a></li>
              <li><a href="#">Measures</a></li>
              <li><a href="compare.html">Compare Two Files</a></li>
              <li><a href="stat.html">Statistcs</a></li>
              <li class="nav-header">Multi-label Support</li>
              <li><a href="#">Link</a></li>
              <li><a href="#">Link</a></li>
              <li><a href="#">Link</a></li>
              </ul>
          </div><!--/.well -->
        </div><!--/span 3-->
        
       <div class="span9">
          <div class="hero-unit">
           <div class="row-fluid">
				 <h2>Versus Distribution Service</h2>
				  
				  <p>Set your parameters, choose your files, and submit. See <a href="VersusDistribution-About.html">About</a> for more help. </p>
				  <p>Results will go here <a href ="VersusDecisionSupport.html">Service</a>.</p>
			</div>
		</div>
			
		<div class="row-fluid">
			<div class="span4">
				<select id="adapter" onclick="setAdapterState()">
					<option value="invalid">-Adapter-</option>
				</select>
			</div>
			
			<div class="span4">		
				<select id="extractor" onclick="setExtractorState()">
					<option value="invalid">-Extractor-</option>
				</select>
			</div>

			<div class="span4">
				<select id="measure" onclick="setMeasureState()">
					<option value="invalid">-Measure-</option>
				</select>
			</div>
	    </div>		
	<style type="text/css">
   #filedrag
   {
   
   display: none;
	font-weight: bold;
	text-align: center;
	height:100px;
	weight:100px;
	padding: 10px;
	margin: 1em 0;
	color: #555;
	border: 5px solid grey;
	border-radius: 7px;
	cursor: default;
	}
	</style>
	<style type="text/css">
  #filedrag.hover
  {
	color: #f00;
	border-color: #f00;
	border-style: solid;
	box-shadow: inset 0 3px 4px #888;
    }
</style>    
	    
	<form id="upload" action="http://localhost:8080/api/v1/files/upload" method="POST" enctype="multipart/form-data">
	<fieldset>
		<legend>File Upload</legend>
	<input type="hidden" id="MAX_FILE_SIZE" name="MAX_FILE_SIZE" value="300000" />
	<div>
		<label for="fileselect">Files to upload:</label>
		<input type="file" id="fileselect" name="fileselect[]" multiple="multiple" />

			<div id="filedrag">or drop files here</div>
	    <!-- output id="list"></output-->
	</div>    
	  <input type="button" value="Upload" id="upload-button-id" disabled="disabled"/>
	<!-- <div id="submitbutton">
	<button type="submit">Upload Files</button>
	</div>-->
	</fieldset>
	</form>
<div id="messages">
<p>Status Messages</p>
</div>

<script>
	//file selection
	// getElementById

	function $id(id) {
		return document.getElementById(id);
		}
//
// output information
	function Output(msg,mgid) {
	//	var m = $id("messages");
	var m=$id(mgid);
		m.innerHTML = msg + m.innerHTML;
	}
//call initialization file
 var fd=new FormData();
 var fileUploaded=[];
	if (window.File && window.FileList && window.FileReader) {
		console.log("I am inside initialization code");
		var uploadBtn=document.getElementById('upload-button-id');
		uploadBtn.removeAttribute('disabled');
		Init();
	}
//
// initialize
function Init() {
		var fileselect = $id("fileselect"),
			filedrag = $id("filedrag"),
			submitbutton = $id("submitbutton");
		 console.log("I am inside Init()");
		 
		 
		 
		 
		// file select
		fileselect.addEventListener("change", FileSelectHandler, false);
		// is XHR2 available?
		var xhr = new XMLHttpRequest();
		if (xhr.upload) {
		// file drop
		filedrag.addEventListener("dragover", FileDragHover, false);
		filedrag.addEventListener("dragleave", FileDragHover, false);
		filedrag.addEventListener("drop", FileSelectHandler, false);
		filedrag.style.display = "block";
		// remove submit button
		//submitbutton.style.display = "none";
		}
}
//file drag hover
function FileDragHover(e) {
		e.stopPropagation();
		e.preventDefault();
		e.target.className = (e.type == "dragover" ? "hover" : "");
	}
function FileSelectHandler(e) {
	// cancel event and hover styling
		FileDragHover(e);
	// fetch FileList object
		var files = e.target.files || e.dataTransfer.files;
	// process all File objects
		// var fd=new FormData();
		for (var i = 0, f; f = files[i]; i++) {
			ParseFile(f);
			//fd.append(f.name,f);
		     UploadFile(f);
	    }
		/*var uploadBtn=document.getElementById('upload-button-id');
		uploadBtn.onclick=function(evt){
			console.log("I am inside click function");
			if(fd == null)
				console.log("fd is null");
			else
		      UploadFile(fd);
		}*/
	}

// upload JPEG files
function UploadFile(file) {
	if(file==null)
		console.log("form data is null");
	var xhr = new XMLHttpRequest();
	if (xhr.upload) {
		// start upload
		xhr.upload.addEventListener('loadstart',onloadstartHandler,false);
		xhr.upload.addEventListener('progress',onprogressHandler,false);
		xhr.upload.addEventListener('load', onloadHandler,false);
		xhr.addEventListener('readystatechange',onreadystatechangeHandler,false);
		//xhr.setRequestHeader("X_FILENAME", file.name);
		fd=new FormData();
		fd.append(file.name,file);
		xhr.open("POST", $id("upload").action, true);
		xhr.send(fd);
		//xhr.send(file);
	}
	else{
		console.log("xhr upload failed");
	}
	/*xhr.onreadystatechange=function(id){
		if (this.readyState==4){
			if(this.status==200){
				console.log(id);
				  fileUploaded.push(id);
				  Output(id,"result");
				//getDecisionSupport(id);
			}
		}
}*/
}

//Handle the start of the transmission
function onloadstartHandler(evt) {
  var div = document.getElementById('upload-status');
  div.innerHTML = 'Upload started!';
}

// Handle the end of the transmission
function onloadHandler(evt) {
  var div = document.getElementById('upload-status');
  div.innerHTML = 'Upload successful!';
}

// Handle the progress
function onprogressHandler(evt) {
  var div = document.getElementById('progress');
  var percent = evt.loaded/evt.total*100;
  div.innerHTML = 'Progress: ' + percent + '%';
}

// Handle the response from the server


function onreadystatechangeHandler(evt) {
  var status = null;
  var readyState=null;

  try {
    status = evt.target.status;
    readyState=evt.target.readyState;
  }
  catch(e) {
    return;
  }

  if (readyState==4){
	  if(status == '200' && evt.target.responseText) {
	  console.log(evt.target.responseText);
	  fileUploaded.push(evt.target.responseText);
	  Output(evt.target.responseText,"result");
	  
  //  var result = document.getElementById('result');
   // result.innerHTML = '<p>The server saw it as:</p><pre>' + evt.target.responseText + '</pre>';
	  }
  }
  console.log(fileUploaded.length);
}
function ParseFile(file) {
	Output(
		"<p>File information: <strong>" + file.name +
		"</strong> type: <strong>" + file.type +
		"</strong> size: <strong>" + file.size +
		"</strong> bytes</p>","messages"
	);
}
</script>
 
		 <!-- Placeholders for messages set by event handlers -->
  <p id="upload-status"></p>
  <p id="progress"></p>
  <pre id="result"></pre>    
	  <footer>
        <p>NCSA -- ISDA</p>
      </footer>
      </div>
      </div> <!-- row fluid container-->
	</div> <!-- /container -->
</body>
</html>